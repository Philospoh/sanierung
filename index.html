<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sanierungsrechner – Schnell-Indikation</title>

<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fafafa;margin:0}
.wrap{max-width:980px;margin:24px auto;padding:0 16px}
.card{background:#fff;border:1px solid #e6e8eb;border-radius:16px;padding:16px;margin-bottom:12px}
h1{font-size:22px;margin:0 0 8px}
h2{font-size:16px;margin:0 0 10px}
.small{font-size:12px;color:#60646c}
.muted{color:#60646c;font-size:13px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.col4{grid-column:span 4}
.col6{grid-column:span 6}
.col8{grid-column:span 8}
.col12{grid-column:span 12}
@media(max-width:900px){.col4,.col6,.col8{grid-column:span 12}}

input,select{width:100%;padding:10px;border:1px solid #d9dde3;border-radius:12px}
.btn{background:#111;color:#fff;border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
.btn.secondary{background:#fff;color:#111;border:1px solid #d9dde3}
.hidden{display:none}
.progress{height:10px;background:#f4f6f8;border-radius:999px;overflow:hidden}
.bar{height:100%;background:#111;width:0}
.pill{border:1px solid #d9dde3;border-radius:999px;padding:8px 12px}
.warn{background:#fff6e5;border:1px solid #ffe0a3;border-radius:14px;padding:12px}
.ok{background:#effff5;border:1px solid #bff0d0;border-radius:14px;padding:12px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e6e8eb;font-size:13px}
th{background:#f4f6f8;text-align:left}
.right{text-align:right}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h1>Sanierungsrechner (Schnell-Indikation)</h1>
<p class="muted">Grobe Kostenspanne & Einspar-Indikation – ohne Förderzusage.</p>
</div>

<div class="card">
<h2 id="stepTitle">Schritt 1 von 4</h2>
<div class="progress"><div class="bar" id="bar"></div></div>
</div>

<!-- STEP 1 -->
<div class="card" id="step1">
<h2>Gebäude</h2>
<div class="grid">
<div class="col4">
<label>Gebäudetyp</label>
<select id="buildingType">
<option value="efh">Einfamilienhaus</option>
<option value="rh">Reihenhaus</option>
<option value="mfh">Mehrfamilienhaus</option>
</select>
</div>

<div class="col4">
<label>Baujahr</label>
<select id="baujahr">
<option value="bis_1978">bis 1978</option>
<option value="1979_1994">1979–1994</option>
<option value="1995_2009">1995–2009</option>
<option value="ab_2010">ab 2010</option>
</select>
</div>

<div class="col4">
<label>Wohnfläche (m²)</label>
<input id="wf" value="140">
<div class="small">Pflichtfeld</div>
</div>

<div class="col6">
<label>Energieträger</label>
<select id="fuel">
<option value="gas">Erdgas</option>
<option value="oil">Heizöl</option>
<option value="district">Fernwärme</option>
<option value="electric">Strom</option>
</select>
</div>

<div class="col6">
<label>Optional: Jahresverbrauch (kWh)</label>
<input id="kwh">
<div class="small" id="kwhHint"></div>
</div>

<div class="col12 hidden" id="kwhWarn"></div>
</div>
</div>

<!-- STEP 2 -->
<div class="card hidden" id="step2">
<h2>Maßnahmen</h2>
<div id="measures" class="grid"></div>
</div>

<!-- STEP 3 -->
<div class="card hidden" id="step3">
<h2>Zusammenfassung</h2>
<div id="summary" class="small"></div>
</div>

<!-- STEP 4 -->
<div class="card hidden" id="step4">
<h2>Ergebnis (Indikation)</h2>

<div class="grid">
<div class="col4 ok">
<div class="small">Investition gesamt</div>
<b id="invTotal"></b>
<div class="small" id="invRange"></div>
</div>
<div class="col4 ok">
<div class="small">Jährliche Einsparung</div>
<b id="savEur"></b>
<div class="small" id="savKwh"></div>
</div>
<div class="col4 ok">
<div class="small">CO₂-Minderung</div>
<b id="co2"></b>
<div class="small">kg/Jahr</div>
</div>
</div>

<table style="margin-top:12px">
<thead><tr><th>Maßnahme</th><th class="right">typ.</th></tr></thead>
<tbody id="rows"></tbody>
</table>

<div class="warn" style="margin-top:12px" id="assumptions"></div>
</div>

<div class="card">
<button class="btn secondary" id="backBtn">Zurück</button>
<button class="btn" id="nextBtn">Weiter</button>
</div>

</div>

<script>
/* ================= KONFIG ================= */
const baselineKwhPerM2={
  bis_1978:190,
  1979_1994:140,
  1995_2009:100,
  ab_2010:70
};

const defaultPrices={gas:0.12,oil:0.12,district:0.14,electric:0.30};
const co2Factors={gas:0.201,oil:0.266,district:0.18,electric:0.363};

const measures=[
{id:"heat",label:"Heizung tauschen",save:0.25,cost:22000},
{id:"facade",label:"Fassade dämmen",save:0.20,cost:24000},
{id:"windows",label:"Fenster erneuern",save:0.10,cost:18000}
];

/* ================= HELPERS ================= */
const €=x=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(x);
const int=x=>Math.round(x);
const parse=v=>Number(String(v).replace(",","."));

/* ================= STATE ================= */
let step=0;
const steps=["step1","step2","step3","step4"];

measures.forEach(m=>{
  measuresEl.innerHTML+=`<div class="col4 pill">
  <label><input type="checkbox" value="${m.id}"> ${m.label}</label>
  </div>`;
});

/* ================= UI ================= */
function showStep(i){
  step=i;
  steps.forEach((s,idx)=>document.getElementById(s).classList.toggle("hidden",idx!==i));
  document.getElementById("bar").style.width=((i+1)/4*100)+"%";
  document.getElementById("stepTitle").textContent=`Schritt ${i+1} von 4`;
  document.getElementById("nextBtn").textContent=i===2?"Ergebnis anzeigen":"Weiter";
  if(i===3)document.getElementById("nextBtn").classList.add("hidden");
  else document.getElementById("nextBtn").classList.remove("hidden");
}

function updateKwhHint(){
  const wf=parse(wfEl.value);
  const b=baselineKwhPerM2[baujahrEl.value];
  if(wf>0&&b)kwhHint.textContent=`Wenn leer: ca. ${int(wf*b)} kWh/Jahr (≈ ${b} kWh/m²a).`;
}

function calculate(){
  const wf=parse(wfEl.value);
  if(!(wf>20)){alert("Wohnfläche prüfen");return;}

  const b=baselineKwhPerM2[baujahrEl.value];
  const baseKwh=parse(kwhEl.value)||wf*b;
  const price=defaultPrices[fuelEl.value];

  const sel=[...document.querySelectorAll('#measures input:checked')]
    .map(x=>measures.find(m=>m.id===x.value));

  const savePct=1-sel.reduce((r,m)=>r*(1-m.save),1);
  const savedKwh=baseKwh*savePct;
  const savedEur=savedKwh*price;

  invTotal.textContent=€(sel.reduce((a,m)=>a+m.cost,0));
  savEur.textContent=€(savedEur);
  savKwh.textContent=int(savedKwh)+" kWh/Jahr";
  co2.textContent=int(savedKwh*(co2Factors[fuelEl.value]||0));

  rows.innerHTML="";
  sel.forEach(m=>rows.innerHTML+=`<tr><td>${m.label}</td><td class="right">${€(m.cost)}</td></tr>`);

  assumptions.innerHTML=`Verbrauchsbasis ${int(baseKwh)} kWh/Jahr (Richtwert Baujahr),
  Einsparung konservativ kombiniert.`;

  showStep(3);
}

/* ================= EVENTS ================= */
const wfEl=wf, kwhEl=kwh, baujahrEl=baujahr, fuelEl=fuel;

wfEl.oninput=kwhEl.oninput=baujahrEl.onchange=updateKwhHint;

backBtn.onclick=()=>showStep(Math.max(0,step-1));
nextBtn.onclick=()=>{
  if(step===2){calculate();return;}
  showStep(step+1);
};

updateKwhHint();
showStep(0);
</script>
</body>
</html>
